<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Отметка по QR</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Tailwind через CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-900 text-slate-50 min-h-screen">
  <div class="max-w-md mx-auto px-4 py-6 flex flex-col gap-4">
    <header class="text-center">
      <h1 class="text-2xl font-bold mb-2">Сканирование QR лекции</h1>
      <p class="text-sm text-slate-300">
        Открой это окно <span class="font-semibold">через кнопку бота</span> «Сканировать QR лекции».
      </p>
    </header>

    <div id="authWarning" class="hidden bg-red-500/20 border border-red-500 text-red-100 text-sm rounded-xl px-3 py-2">
      Похоже, WebApp открыт не в Telegram. Открой сканер через кнопку в чате с ботом.
    </div>

    <div id="statusBox" class="bg-slate-800 border border-slate-700 rounded-xl px-3 py-2 text-sm">
      <div class="font-semibold mb-1">Статус</div>
      <div id="status" class="text-slate-200">Нажми «Начать сканирование».</div>
    </div>

    <div class="rounded-2xl overflow-hidden border border-slate-700 bg-black aspect-[3/4] flex items-center justify-center">
      <video
        id="video"
        class="w-full h-full object-cover transition-transform duration-150"
        autoplay
        playsinline
      ></video>
      <canvas id="canvas" class="hidden"></canvas>
    </div>

    <div class="flex items-center justify-center gap-2 -mt-2">
      <button
        id="zoomOutBtn"
        class="w-10 h-8 flex items-center justify-center rounded-lg bg-slate-800 border border-slate-600 text-lg"
      >−</button>
      <span id="zoomValue" class="text-xs text-slate-300">1.0x</span>
      <button
        id="zoomInBtn"
        class="w-10 h-8 flex items-center justify-center rounded-lg bg-slate-800 border border-slate-600 text-lg"
      >+</button>
    </div>

    <div id="resultBox" class="hidden bg-emerald-500/10 border border-emerald-500 rounded-xl px-3 py-2 text-xs break-all">
      <div class="font-semibold mb-1">Содержимое QR:</div>
      <div id="qrResult"></div>
    </div>

    <div class="flex gap-2">
      <button
        id="startBtn"
        class="flex-1 bg-emerald-500 hover:bg-emerald-600 active:bg-emerald-700 text-white font-semibold py-2 px-4 rounded-xl text-sm transition"
      >
        Начать сканирование
      </button>
      <button
        id="stopBtn"
        class="flex-1 bg-slate-700 hover:bg-slate-600 active:bg-slate-700 text-slate-100 font-semibold py-2 px-4 rounded-xl text-sm transition disabled:opacity-40"
        disabled
      >
        Остановить
      </button>
    </div>

    <p class="text-xs text-slate-400">
      Совет: наведи камеру ближе к QR-коду. Используй кнопки «+» и «−» для приближения.
    </p>
  </div>

  <!-- jsQR для распознавания QR -->
  <script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.js"></script>
  <!-- Telegram WebApp JS -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script src="./main.js"></script>
</body>
</html>
